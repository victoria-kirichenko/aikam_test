# Worker with DB and Json

## Общие требования
* Используемый стэк: java 8, PostgreSQL, Maven
* Входные параметры: тип операции, путь к входному файлу, путь к файлу результата
* Формат файлов: JSON
* дамп БД, входные файлы

## Инструкция по запуску

1. в aikam_test/src/main/resources лежит дамп БД dump.sql, запустить его можно в cmd (нужно находится в папке ресурсов при запуске cmd) с помощью команды psql -U postgres -d aikam_shop < dump.sql -p 5433 <номер порта на котором у вас должен быть запущен сервер>
2. для появления jar-файла запустить команду mvn clean package
3. Находясь в корневой папке проекта можно сделать 2 вида запуска из консоли:
   * java -jar target/program-jar-with-dependencies.jar search --input inputsearch.json --output outputsearch.json
   * java -jar target/program-jar-with-dependencies.jar stat --input inputstat.json --output outputstat.json

## Цель проекта
Создание программы для анализа данных о покупках и покупателях.

## Структура данных

* Покупатели(имя, фамилия)
* Товары(название, цена)
* Покупки(покупатель, товар, дата покупки)

## Типы и Описание операций

1. Поиск покупателей по критериям (search)
Во входном файле передаётся список критериев для поиска покупателей. Результат операции - списки покупателей для каждого критерия из запроса. Порядок списков такой же как в запросе, порядок покупателей в списке — произвольный.
Важно: Критерии могут повторяться, например, два раза критерий с lastName.

2. Статистика за период (stat)
Во входном файле передаётся интервал дат сбора статистики. Результат операции - статистика по покупателям за период из двух дат, включительно, без выходных.

* В случае возникновения ошибки, при выполнении любой операции - фиксируется результат.

## Задачи
* Разработка программы, способной принимать входные критерии из JSON-файла.
* Поиск и анализ данных в базе данных, в зависимости от критериев, переданных в запросе.
* Поиск и анализ данных в базе данных, в зависимости от указанного периода дат, переданных в запросе.
* Генерация выходных данных в формате JSON с результатами анализа.

## Использованные инструменты
* Java 8 - для разработки программы.
* PostgreSQL - для хранения данных о покупках и покупателях.
* Maven - для управления зависимостями и сборкой проекта.
* Библиотеки Java, такие как JCommander и Jackson, для обработки аргументов командной строки и работы с JSON-файлами.

## Архитектурные решения
![архитектурные решения](https://github.com/victoria-kirichenko/aikam_test/blob/main/aikam_test/Diagrams.png)

* Из плюсов: можно масштабировать количество команд от интерфейса. Команды могут быть реализованы как независимые модули или плагины, что облегчает их сопровождение и тестирование. Это также способствует чистоте кода и изоляции функциональности.
* Из минусов: в классе WriteJson нарушен как раз таки принцип единственной ответственности, это можно было бы исправить если бы сделать WriterJson интферфейсом, а методы сделать классами имплементирующими этот интерфейс. Загвоздка в том, что у этих методов разные параметры, поэтому нужно возможно по другому пересмотреть идею.

*Заметка: команда stat не до конца реализована. Не реализован метод writeStatResultToJson(List<List<Object[]>> data, String filePath, Date startDate, Date endDate) в классе WriterJson. 
